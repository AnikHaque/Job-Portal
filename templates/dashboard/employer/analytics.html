<h3 class="mb-4">Analytics Overview</h3>

<!-- ================= KPI CARDS ================= -->
<div class="row mb-5">
  <div class="col-md-3">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h4>{{ total_jobs }}</h4>
        <p class="text-muted mb-0">Jobs</p>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h4>{{ total_applications }}</h4>
        <p class="text-muted mb-0">Applications</p>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h4 class="text-success">{{ shortlisted }}</h4>
        <p class="text-muted mb-0">Shortlisted</p>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card text-center shadow-sm">
      <div class="card-body">
        <h4 class="text-danger">{{ rejected }}</h4>
        <p class="text-muted mb-0">Rejected</p>
      </div>
    </div>
  </div>
</div>

<!-- ================= CHARTS ================= -->
<div class="row mb-5">

  <!-- Bar Chart -->
  <div class="col-md-8">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="mb-3">Applications per Job</h5>
        <canvas id="applicationsBarChart" height="120"></canvas>
      </div>
    </div>
  </div>

  <!-- Pie Chart -->
  <div class="col-md-4">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="mb-3">Application Status</h5>
        <canvas id="statusPieChart"></canvas>

        <div class="mt-3 small text-muted">
          <div>Pending: <strong>{{ pending }}</strong></div>
          <div>Shortlisted: <strong>{{ shortlisted }}</strong></div>
          <div>Rejected: <strong>{{ rejected }}</strong></div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- ================= TREND + INSIGHTS ================= -->
<div class="row">

  <!-- Line Chart -->
  <div class="col-md-8">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="mb-3">Applications Trend (Last 7 Days)</h5>
        <canvas id="trendLineChart" height="120"></canvas>
      </div>
    </div>
  </div>

  <!-- Insights -->
  <div class="col-md-4">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="mb-3">Insights</h5>
        <ul class="list-unstyled small mb-0">
          <li class="mb-2">üìå Most applications received recently</li>
          <li class="mb-2">üìà Shortlisting rate improving</li>
          <li class="mb-2">‚è± Average response time ~ 2 days</li>
          <li class="mb-2">üèÜ Best performing job this week</li>
        </ul>
      </div>
    </div>
  </div>

</div>

<!-- ================= SAFE JSON DATA ================= -->
<script id="analytics-data" type="application/json">
{
  "job_titles": {{ job_titles|default:"[]"|safe }},
  "applications_per_job": {{ applications_per_job|default:"[]"|safe }},
  "last_7_days": {{ last_7_days|default:"[]"|safe }},
  "applications_trend": {{ applications_trend|default:"[]"|safe }},
  "shortlisted": {{ shortlisted|default:0 }},
  "rejected": {{ rejected|default:0 }},
  "pending": {{ pending|default:0 }}
}
</script>

<!-- ================= CHART.JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const analyticsData = JSON.parse(
  document.getElementById("analytics-data").textContent
);

/* ===== BAR CHART ===== */
new Chart(document.getElementById('applicationsBarChart'), {
  type: 'bar',
  data: {
    labels: analyticsData.job_titles,
    datasets: [{
      label: 'Applications',
      data: analyticsData.applications_per_job,
      borderRadius: 6
    }]
  },
  options: {
    plugins: {
      legend: { display: false }
    }
  }
});

/* ===== PIE / DOUGHNUT ===== */
new Chart(document.getElementById('statusPieChart'), {
  type: 'doughnut',
  data: {
    labels: ['Shortlisted', 'Rejected', 'Pending'],
    datasets: [{
      data: [
        analyticsData.shortlisted,
        analyticsData.rejected,
        analyticsData.pending
      ]
    }]
  }
});

/* ===== LINE CHART ===== */
new Chart(document.getElementById('trendLineChart'), {
  type: 'line',
  data: {
    labels: analyticsData.last_7_days,
    datasets: [{
      label: 'Applications',
      data: analyticsData.applications_trend,
      tension: 0.4,
      fill: false
    }]
  }
});
</script>
